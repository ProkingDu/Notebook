## 概述

**基于php与mysql数据库的分布式储存图床**，将图像上传到网站即可在不同的节点储存 数据（服务器：北京、七牛云：华东-浙江）

**前端基于原生的html、css、javascript开发。****
**
项目已经部署在云服务器上正常运行，接入七牛云对象储存服务，域名已经进行工信部备案，网站仅供个人使用。

项目地址：[简单图床 (xiaodu0.com)](http://pic.xiaodu0.com/index)
Github: [ProkingDu/EasyPic: A easy web picture bed. (github.com)](https://github.com/ProkingDu/EasyPic)

目前仅完成基础功能开发，未来结合项目名称会开发结合Python的OCR识别以及文本标注和可以对图片可视化编辑后上传的功能，进一步优化前端交互体验。



## 技术栈

  

- PHP 7.1

- thinkphp 5.1

- mysql 5.7

- html

- css

- javascript

  

## 用到的环境和依赖

  

- Centos7.9

- 宝塔Linux面板

- Nginx

- 七牛云储存

- 必应壁纸服务



## 图片上传

### 单图上传

单图上传考虑到交互性和便捷性，有三种上传图片的方式：**拖动上传、粘贴上传、点击上传。**

![小杜的个人图床](http://src.xiaodu0.com/2024/04/23/7da5e4924128aae32eda1d7242dcb157.jpg)![小杜的个人图床](http://src.xiaodu0.com/2024/04/13/be50285f2808a613e8dbca7006ee21fe.png)

同时考虑到用户使用图床需要将上传后的图片放到markdown中，因此在上传生成外链之后再格式化markdown代码。同时生成html图片

标签以及直接提供外链，演示：
![小杜的个人图床](http://src.xiaodu0.com/2024/04/13/f54ea9dbf8d38cd97fec0451f4dc8192.jpg)

![小杜的个人图床](http://src.xiaodu0.com/2024/04/13/fe4c0310675127dc0ae5312c0c6a9216.jpg)

在上传完图片之后点击继续上传即可刷新页面重新上传。

**这里考虑到加载动画会耽误时间的问题，未来将其优化为无需刷新即可接着上传图片。**

### 批量传图

![小杜的个人图床](http://src.xiaodu0.com/2024/04/23/2ab71d5ee309823f48f234a293c2509f.webp)

例如某些需要粘贴大量图片到markdown的场景，使用批量传图可以快捷批量生成图片外链和标签代码。

由于批量传图无法直接通过表单操作， 因此只开发了点击按钮添加图片的的添加方法。

示例：

![小杜的个人图床](http://src.xiaodu0.com/2024/04/13/41e8a7e3f8bd9b4b6883ea94c9158613.jpg)
## 图片查询

针对个人上传的图片，可以通过文件名加密后的URL链接和文件md5找到该文件。


演示：



![[Pasted image 20240413042834.png]]

## 技术实现

### 环境

![image-20240423234539574](C:\Users\28110\AppData\Roaming\Typora\typora-user-images\image-20240423234539574.png)


环境配置采用腾讯云轻量应用服务器：


预装centos7.9操作系统。


为方便操作使用宝塔面板对网站运维。


PHP版本使用7.1

数据库使用Mysql5.7.




### 数据表设计

由于目前只实现了网站基础功能，只设计了两张数据表，通过phpmyadmin查看数据表：




其中`pic_config`用于储存系统配置信息，`pic_log`用于储存图片上传记录。



### 后端开发


后端使用thinkphp框架，采用传统的MVC架构。

其中文件实现通过编写API实现，在图传API被调用后判断是否上传到七牛云采用分布式储存。

每个数据表对应一个模型，通过模型对数据库进行操作。

### 前端开发

由于图床更强调使用的便捷性，因此大部分工作都在前端开发上。

首先是整体的网页设计没用使用太多的html标签支撑，而是动态的使用js构建，并且将多数常用的代码封装为函数，因为目前是在初步开发阶段，使用函数式编程能够快速实现业务，在基本功能完善后再对项目进行重构。


css目前在两个页面单独编写，此后将复用性高的css剥离出来单独封装文件，目前已经将常用的动画整理完毕。

一些技术点的实现：

1. **开屏动画**：

使用一个占据整个屏幕的容器包含若干个（可以在js中调整）子元素构成的，通过3d变化产生旋转的效果，在页面加载完成延迟一定时间隐藏动画。


2. **顶部栏动画**

简单的使用transform变换来实现位移，在查图页面同理。

3. **拖动上传图片**

监听drag事件并移除默认的下载事件，得到事件对象中包含的图片来上传。

4. **粘贴图片上传**

同理，通过监听粘贴事件来获得文件对象进行上传。

5. **点击上传图片**

隐藏一个input元素，其类型为file，当监听到点击事件时调用input的点击事件调出文件选择。


6. **查图页遮罩**

通过子元素覆盖的方式实现背景图和背景模糊效果以防止元素中的文本也被模糊处理。
背景图片随机选择bing每日壁纸。
文字通过mix-blend-mode调整混合模式为diference来实现不同背景图片下文字颜色的清晰显示，但是原始文字颜色必须是白色的（能够适应颜色变化）


## 未来方向

在项目基本能够正常使用的情况下，打算扩充更改功能：

1. 例如某些时候截图的图片有重要的信息，或者一些比较有价值的文字，通过结合Python实现OCR识别 。
2. 某些情境下需要编辑图片标注重点，开发在线编辑图片的功能
3. 防止图片丢失，将网站的静态资源分布式储存，将现在部署的服务器作为负载均衡使用，其他的服务器/对象储存作为资源点。
4. ......

