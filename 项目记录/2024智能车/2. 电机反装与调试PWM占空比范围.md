### 反装电机


舵机调试完之后要做最主要的运动部分，也就是电机的调试，由于所有这个型号的车都存在前进速度慢，倒车速度快的问题，看了别人的解决方式是直接反装电机，把原先前进的PWM信号转化为后退的信号，而把后退的信号转为前进的信号。



![小杜的个人图床](http://src.xiaodu0.com/2024/09/21/78f8251a058a099524f308048a748a13.jpeg)

![小杜的个人图床](http://src.xiaodu0.com/2024/09/21/54086ccaa610151c9b2098e36b237ec7.jpg)



这里一开始我把电机拆了下来，寻思怎么反装来着，然后发现这里是齿轮驱动的，观察一下发现齿轮顺时针旋转，传动轴的齿轮逆时针旋转，则车辆前进，反之电机齿轮逆时针、传动轴齿轮顺时针，车辆后退。这里的关系不太重要，主要是电机如何反装，即使我把他转一圈装这个关系也不会变。

其实这里要解决的主要问题就是让原先使齿轮顺时针旋转的PWM信号转为逆时针旋转，然后去网上搜索了一下关于pwm直流电机的文章，这里找到一篇参考：
[PWM如何控制直流电机_pwm控制直流电机-CSDN博客](https://blog.csdn.net/weixin_45020839/article/details/124609925)

也就是电机的工作依赖于磁场产生的力，而电流的方向和磁场的方向共同决定了力的方向，进而决定了电机转子的旋转方向。**当电流的方向改变时，电机转子受到的力的方向也会随之改变，从而导致电机反转。**

所以问题就很简单了，直接将电机连接的电源线调换，这时候电流的方向发生改变，产生力的方向也反转过来，所以这时候原先前进就变成了后退，原先后退变成了前进，也就解决了前进速度慢，后退速度快的问题。

![小杜的个人图床](http://src.xiaodu0.com/2024/09/21/d815faacdc126f8fbcee7a56e0ee6e5c.jpg)


测试视频：


### 占空比调试

解决了之前舵机的问题这里调试占空比就简单多了，同样把线接上之后，根据引脚分布图找到：
**电机驱动器对应的pwm针脚是GPIO22针脚，对应的物理编号是15。**

这里我使用的是PIGPIO库来进行pwm输出，因此使用23号的BCM编号。

**根据赛事资料，电机驱动器接收的pwm频率是200，占空比范围在\[25,40000]，电机驱动器激活的占空比是10000**

所以这里只要从10000开始向正负方向遍历即可找到电机最佳速度：
```python
import time
import pigpio as pio
import os
from threading import Timer


# open_io="sudo pigpiod"
 
# close_io="sudo killall pigpiod"
# os.system(close_io)
# os.system(open_io)


pwm_pin = 22 #定义pwm输出引脚：电调口 13
pi = pio.pi()#实例化pigpio对象
pi.set_mode(pwm_pin,pio.OUTPUT) #设置PWM引脚为输出状态

pi.set_PWM_frequency(pwm_pin,200)#设定14号引脚产生的pwm波形的频率为50Hz
pi.set_PWM_range(pwm_pin,40000) #限制占空比的范围（一个pwm周期分成多少份），总范围25-40000。
#解锁
pi.set_PWM_dutycycle(pwm_pin,10000) #指定pwm波形脉宽

# 前进
for dy in range(10000,11000,100):#230
            pi.set_PWM_dutycycle(pwm_pin,dy)
            print (dy)
            time.sleep(1)

# 后退
for dy in range(10000,9000,-100):#230
            pi.set_PWM_dutycycle(pwm_pin,dy)
            print (dy)
            time.sleep(1)

```


经过调试：
**当pwm占空比在10000以上时，车辆前进，在10000以下时，车辆后退。**

这个参数是在电机调换之后得到的，在反转之前，这个参数也是相反的。

完成舵机和电机的安装和调试之后，接下来的工作是对摄像头和扬声器接线，然后测试。

